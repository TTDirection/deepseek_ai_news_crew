# AI新闻日报自动任务设置指南

本文档说明如何设置自动生成AI热点新闻报告并发送至企业微信的定时任务。根据配置，系统会在：
- 工作日（周一至周五）：早上9点自动运行
- 周末（周六和周日）：中午12点自动运行

## 文件说明

- `auto_run.py`: 自动运行脚本，执行crewai并记录日志
- `run_ai_news.bat`: 批处理文件，用来执行Python脚本
- `ai_news_daily_task.xml`: Windows任务计划程序的XML配置文件
- `logs/`: 日志文件夹，存放每次运行的日志

## 设置步骤

### 1. 确保环境正确配置

确保已安装Python环境并安装了所需的包：

```bash
pip install crewai langchain_openai python-dotenv
```

### 2. 确认 .env 文件配置

确保项目根目录下的 .env 文件包含所有必要的API密钥：

```
DEEPSEEK_API_KEY=你的DeepSeek API密钥
SEARCH_API_KEY=你的搜索API密钥
SEARCH_ENGINE_ID=你的搜索引擎ID
WECHAT_WEBHOOK_KEY=你的企业微信Webhook密钥
```

### 3. 使用Windows任务计划程序设置定时任务

方法一：使用XML文件导入
1. 打开Windows任务计划程序（在开始菜单搜索"任务计划程序"）
2. 右键点击左侧的"任务计划程序库"，选择"导入任务..."
3. 选择项目目录中的 `ai_news_daily_task.xml` 文件
4. 根据需要修改任务设置，特别是用户账户信息和路径
5. 点击"确定"保存任务

方法二：手动创建任务
1. 打开Windows任务计划程序
2. 右键点击左侧的"任务计划程序库"，选择"创建基本任务..."
3. 输入任务名称（如"AI新闻日报任务"）和描述
4. 选择"每周"作为触发器类型
5. 设置两个触发器：
   - 第一个触发器：选择周一至周五，开始时间设为上午9:00
   - 第二个触发器：选择周六和周日，开始时间设为中午12:00
6. 选择"启动程序"作为操作
7. 浏览并选择 `D:\AI\deepseek_ai_news_crew\run_ai_news.bat` 文件
8. 设置工作目录为 `D:\AI\deepseek_ai_news_crew`
9. 完成设置

### 4. 测试任务

可以手动运行批处理文件测试是否工作正常：
1. 双击 `run_ai_news.bat` 文件
2. 查看命令行输出和 `logs` 目录下的日志文件
3. 确认AI新闻报告是否正确生成并发送到企业微信

## 自定义设置

### 修改运行时间

当前配置的运行时间为：
- 工作日（周一至周五）：早上9点
- 周末（周六和周日）：中午12点

如果需要修改，请在任务计划程序中编辑任务的触发器设置。

### 禁用企业微信发送

如果暂时不需要发送到企业微信，可以修改 `.env` 文件：

```
INCLUDE_WECHAT=false  # 禁用企业微信发送
```

### 日志管理

日志文件会累积在 `logs` 目录下。可以考虑定期清理旧的日志文件，或者编写脚本自动删除超过一定天数的日志。

## 故障排除

- 如果任务未按计划运行，检查Windows事件查看器中的错误信息
- 确保计算机在计划任务时间处于开机状态，或启用"计算机唤醒运行此任务"选项
- 检查用户权限问题，可能需要以管理员身份运行任务
- 查看日志文件了解失败细节